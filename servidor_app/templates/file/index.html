{% extends "base.html" %}

{% block title %}Meus Arquivos - Dashboard{% endblock %}

{% block content %}
<div class="content-header">
    <h2 class="fw-bold mb-0">
        <i class="bi bi-folder me-2"></i>
        {% if current_path %}
            {{ current_path.rsplit('/', 1)[-1] }}
        {% else %}
            Meus Arquivos
        {% endif %}
    </h2>
    <div>
        {% if current_path %}
            <a href="{% if parent_path %}/browse/{{ parent_path }}{% else %}/{% endif %}" class="btn btn-primary nav-link-loader">
                <i class="bi bi-arrow-left me-1"></i> Voltar
            </a>
        {% endif %}
    </div>
</div>

<div class="filter-bar mb-4">
    <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-filter me-2"></i>Tipo
        </button>
        <ul class="dropdown-menu" id="filter-type">
            <li><a class="dropdown-item" href="#" data-filter-type="all">Todos</a></li>
            <li><a class="dropdown-item" href="#" data-filter-type="dir"><i class="bi bi-folder-fill me-2"></i>Pastas</a></li>
            <li><a class="dropdown-item" href="#" data-filter-type="image"><i class="bi bi-file-earmark-image-fill me-2"></i>Imagens</a></li>
            <li><a class="dropdown-item" href="#" data-filter-type="pdf"><i class="bi bi-filetype-pdf me-2"></i>PDFs</a></li>
            <li><a class="dropdown-item" href="#" data-filter-type="document"><i class="bi bi-filetype-doc me-2"></i>Documentos</a></li>
            <li><a class="dropdown-item" href="#" data-filter-type="zip"><i class="bi bi-file-earmark-zip-fill me-2"></i>Zip</a></li>
        </ul>
    </div>
    <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-clock me-2"></i>Alteração
        </button>
        <ul class="dropdown-menu" id="filter-date">
            <li><a class="dropdown-item" href="#" data-filter-date="all">Qualquer Data</a></li>
            <li><a class="dropdown-item" href="#" data-filter-date="today">Hoje</a></li>
            <li><a class="dropdown-item" href="#" data-filter-date="week">Últimos 7 dias</a></li>
            <li><a class="dropdown-item" href="#" data-filter-date="month">Últimos 30 dias</a></li>
        </ul>
    </div>
</div>

<div id="file-system-view" class="card-elegant p-4" data-pastas='{{ pastas | tojson | safe }}'>
    <div id="file-list-container" class="list-group list-group-flush">
        </div>
</div>

<!-- Pagination Controls -->
{% if pagination and pagination.total_pages > 1 %}
<div class="d-flex justify-content-between align-items-center mt-4">
    <div class="text-muted">
        Mostrando {{ (pagination.page - 1) * pagination.per_page + 1 }} a {{ min(pagination.page * pagination.per_page, pagination.total_items) }} de {{ pagination.total_items }} itens
    </div>

    <nav aria-label="Navegação de páginas">
        <ul class="pagination pagination-sm mb-0">
            <!-- Previous Button -->
            {% if pagination.has_prev %}
            <li class="page-item">
                <a class="page-link nav-link-loader" href="{% if current_path %}{{ url_for('file.browse', sub_path=current_path, page=pagination.prev_page, per_page=pagination.per_page) }}{% else %}{{ url_for('file.index', page=pagination.prev_page, per_page=pagination.per_page) }}{% endif %}">
                    <i class="bi bi-chevron-left"></i> Anterior
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">
                    <i class="bi bi-chevron-left"></i> Anterior
                </span>
            </li>
            {% endif %}

            <!-- Page Numbers -->
            {% set start_page = max(1, pagination.page - 2) %}
            {% set end_page = min(pagination.total_pages, pagination.page + 2) %}

            {% if start_page > 1 %}
            <li class="page-item">
                <a class="page-link nav-link-loader" href="{% if current_path %}{{ url_for('file.browse', sub_path=current_path, page=1, per_page=pagination.per_page) }}{% else %}{{ url_for('file.index', page=1, per_page=pagination.per_page) }}{% endif %}">1</a>
            </li>
            {% if start_page > 2 %}
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
            {% endif %}
            {% endif %}

            {% for page_num in range(start_page, end_page + 1) %}
            <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                <a class="page-link nav-link-loader" href="{% if current_path %}{{ url_for('file.browse', sub_path=current_path, page=page_num, per_page=pagination.per_page) }}{% else %}{{ url_for('file.index', page=page_num, per_page=pagination.per_page) }}{% endif %}">{{ page_num }}</a>
            </li>
            {% endfor %}

            {% if end_page < pagination.total_pages %}
            {% if end_page < pagination.total_pages - 1 %}
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
            {% endif %}
            <li class="page-item">
                <a class="page-link nav-link-loader" href="{% if current_path %}{{ url_for('file.browse', sub_path=current_path, page=pagination.total_pages, per_page=pagination.per_page) }}{% else %}{{ url_for('file.index', page=pagination.total_pages, per_page=pagination.per_page) }}{% endif %}">{{ pagination.total_pages }}</a>
            </li>
            {% endif %}

            <!-- Next Button -->
            {% if pagination.has_next %}
            <li class="page-item">
                <a class="page-link nav-link-loader" href="{% if current_path %}{{ url_for('file.browse', sub_path=current_path, page=pagination.next_page, per_page=pagination.per_page) }}{% else %}{{ url_for('file.index', page=pagination.next_page, per_page=pagination.per_page) }}{% endif %}">
                    Próximo <i class="bi bi-chevron-right"></i>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">
                    Próximo <i class="bi bi-chevron-right"></i>
                </span>
            </li>
            {% endif %}
        </ul>
    </nav>

    <!-- Items per page selector -->
    <div class="dropdown">
        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            {{ pagination.per_page }} por página
        </button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item nav-link-loader" href="{% if current_path %}{{ url_for('file.browse', sub_path=current_path, page=1, per_page=10) }}{% else %}{{ url_for('file.index', page=1, per_page=10) }}{% endif %}">10 por página</a></li>
            <li><a class="dropdown-item nav-link-loader" href="{% if current_path %}{{ url_for('file.browse', sub_path=current_path, page=1, per_page=25) }}{% else %}{{ url_for('file.index', page=1, per_page=25) }}{% endif %}">25 por página</a></li>
            <li><a class="dropdown-item nav-link-loader" href="{% if current_path %}{{ url_for('file.browse', sub_path=current_path, page=1, per_page=50) }}{% else %}{{ url_for('file.index', page=1, per_page=50) }}{% endif %}">50 por página</a></li>
            <li><a class="dropdown-item nav-link-loader" href="{% if current_path %}{{ url_for('file.browse', sub_path=current_path, page=1, per_page=100) }}{% else %}{{ url_for('file.index', page=1, per_page=100) }}{% endif %}">100 por página</a></li>
        </ul>
    </div>
</div>
{% endif %}
{% endblock %}
